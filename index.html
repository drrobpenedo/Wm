<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Smart Daily Menu Planner</title>
<style>
  :root{
    --bg:#0f1222; --panel:#11142a; --card:#171a2f; --muted:#a9b0d4; --text:#eef1ff;
    --line:#242a4f; --accent:#8fd3fe; --accent2:#a78bfa; --ok:#90f0b5; --warn:#ffb38a; --danger:#ff6b6b;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#0f1222;color:var(--text)}
  header{padding:18px 12px;text-align:center;position:sticky;top:0;z-index:5;
    background:linear-gradient(180deg,rgba(15,18,34,.95),rgba(15,18,34,.75),rgba(15,18,34,0));
    backdrop-filter:blur(6px)}
  h1{margin:0;font-size:clamp(20px,3vw,30px)}
  .sub{color:var(--muted);font-size:13px;margin-top:6px}
  main{max-width:1100px;margin:0 auto;padding:16px}
  .grid{display:grid;gap:14px;grid-template-columns:repeat(12,1fr)}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.02));border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .span-4{grid-column:span 4}.span-6{grid-column:span 6}.span-8{grid-column:span 8}.span-12{grid-column:span 12}
  @media (max-width:980px){.span-4,.span-6,.span-8{grid-column:span 12}}
  label{display:block;font-size:13px;color:var(--muted);margin:8px 0 6px}
  input[type="number"], select{width:100%;background:var(--card);color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;font-size:14px;outline:none}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .row > *{flex:1}
  .btn{padding:12px 16px;border-radius:12px;border:1px solid transparent;font-weight:700;cursor:pointer;color:#06121a;background:linear-gradient(135deg,var(--accent),var(--accent2));width:100%}
  .btn:active{transform:translateY(1px)}
  .btn-ghost{background:transparent;border:1px solid var(--line);color:var(--text)}
  .reset{background:#ff6b6b;color:#fff;border:none}
  .pill{padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.03);font-size:12px;color:var(--muted)}
  .title{font-size:13px;text-transform:uppercase;letter-spacing:.12em;color:var(--muted)}
  .key{display:grid;grid-template-columns:1fr auto;gap:8px;padding:10px;border-radius:10px;background:linear-gradient(180deg,rgba(143,211,254,.07),rgba(167,139,250,.07));border:1px dashed var(--line);margin-top:8px}
  .badge{display:inline-flex;align-items:center;gap:6px;font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.03)}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .danger{color:var(--danger)}
  .divider{height:1px;background:var(--line);margin:12px 0}
  .small{font-size:12px;color:var(--muted)} .num{font-variant-numeric:tabular-nums}
  ul{margin:8px 0 0 18px}
  .choice{display:flex;gap:8px;align-items:center}
</style>
</head>
<body>
<header>
  <h1>Smart Daily Menu Planner</h1>
  <div class="sub">10 menu options • Reset • Cardio & weights recommendations aligned to your goal</div>
</header>

<main class="grid">
  <!-- GOALS -->
  <section class="card span-6">
    <div class="title">Goal & Profile</div>
    <label>Your weight (lb)
      <input id="weight" type="number" min="70" step="1" value="160">
    </label>
    <label>Target weight loss this week (lb)
      <input id="lbsWeek" type="number" min="0" step="0.1" value="1.0">
    </label>
    <label>Estimated daily maintenance calories (kcal) <span class="small">(default 2000; edit if you know yours)</span>
      <input id="maintenance" type="number" min="1000" step="10" value="2000">
    </label>

    <div class="key">
      <div>
        <div class="small">Required daily deficit</div>
        <strong><span id="deficit" class="num">500</span> kcal/day</strong>
      </div>
      <div class="badge" id="deficitBadge">Status</div>
    </div>
    <div class="key">
      <div>
        <div class="small">Dietary calorie target (before exercise)</div>
        <strong><span id="dailyTarget" class="num">1500</span> kcal</strong>
      </div>
      <div class="small">We’ll add back exercise calories</div>
    </div>

    <div class="row" style="margin-top:10px">
      <button class="btn" id="genPlan">Generate / Update Plan</button>
      <button class="reset" id="resetBtn">Reset</button>
    </div>
  </section>

  <!-- MEAL -->
  <section class="card span-6">
    <div class="title">Meal You’re Planning</div>
    <label>Meal type
      <select id="mealType">
        <option value="breakfast">Breakfast (25% of day)</option>
        <option value="lunch">Lunch (30% of day)</option>
        <option value="dinner">Dinner (35% of day)</option>
        <option value="snack">Snack (10% of day)</option>
      </select>
    </label>

    <div class="key">
      <div>
        <div class="small">Target calories for this meal (pre-exercise)</div>
        <strong><span id="mealCalBase" class="num">375</span> kcal</strong>
      </div>
      <div class="small"><span id="mealShare">25%</span> of daily target</div>
    </div>

    <div class="divider"></div>
    <div class="title">Choose Menu Item (10 options)</div>
    <div class="choice">
      <select id="menuChoice"></select>
      <button class="btn-ghost" id="randomize">Randomize</button>
    </div>
    <div class="small" id="menuMeta"></div>
  </section>

  <!-- EXERCISE INPUT (OPTIONAL) -->
  <section class="card span-12">
    <div class="title">Exercise (Optional actual plan)</div>
    <div class="row" style="gap:12px">
      <label class="choice" style="flex:none">
        <input type="checkbox" id="willExercise"> <span> I will exercise today</span>
      </label>
      <span class="pill">If toggled, we’ll add back your estimated burn to meal targets.</span>
    </div>

    <div id="exerciseBlock" style="display:none; margin-top:10px">
      <div class="row">
        <div>
          <label>Cardio minutes</label>
          <input id="cardioMin" type="number" min="0" step="5" value="30">
        </div>
        <div>
          <label>Cardio intensity</label>
          <select id="cardioInt">
            <option value="walk">Walk (3.5 mph)</option>
            <option value="jog" selected>Jog (5 mph)</option>
            <option value="run">Run (6 mph)</option>
          </select>
        </div>
        <div>
          <label>Weights minutes</label>
          <input id="weightsMin" type="number" min="0" step="5" value="20">
        </div>
        <div>
          <label>Weights intensity</label>
          <select id="weightsInt">
            <option value="light">Light</option>
            <option value="moderate" selected>Moderate</option>
            <option value="vigorous">Vigorous</option>
          </select>
        </div>
      </div>

      <div class="key">
        <div>
          <div class="small">Estimated calories burned</div>
          <strong><span id="exKcal" class="num">0</span> kcal</strong>
        </div>
        <div class="small">Walking/jogging based on weight; weights burn by intensity.</div>
      </div>

      <div class="key">
        <div>
          <div class="small">Adjusted daily calorie target (after exercise)</div>
          <strong><span id="dailyAdj" class="num">1500</span> kcal</strong>
        </div>
        <div class="small">Adds exercise calories back</div>
      </div>

      <div class="key">
        <div>
          <div class="small">Adjusted target for this meal</div>
          <strong><span id="mealCalAdj" class="num">375</span> kcal</strong>
        </div>
        <div class="small">Scaled by meal share</div>
      </div>
    </div>
  </section>

  <!-- RECOMMENDATIONS -->
  <section class="card span-12">
    <div class="title">Recommended Cardio & Weight Routine (to safely meet your goal)</div>
    <div class="row">
      <div class="span-6" style="flex:1">
        <h3 style="margin:8px 0 6px">Cardio Recommendation</h3>
        <div id="cardioRec"></div>
      </div>
      <div class="span-6" style="flex:1">
        <h3 style="margin:8px 0 6px">Weight Training Recommendation</h3>
        <div id="weightsRec"></div>
      </div>
    </div>
  </section>

  <!-- RESULT -->
  <section class="card span-12">
    <div class="title">Your Meal Plan</div>
    <h3><span id="mealTitle">Breakfast</span> – <span id="chosenItem">—</span></h3>
    <div class="row">
      <div class="span-6" style="flex:1">
        <div class="key">
          <div>
            <div class="small">Target calories</div>
            <strong><span id="mealCalFinal" class="num">375</span> kcal</strong>
          </div>
          <div class="small">Auto-adjusted by exercise & share</div>
        </div>
        <div class="row" style="margin-top:8px">
          <div class="badge"><strong>Carbs:</strong> <span id="gCarb" class="num">0</span> g</div>
          <div class="badge"><strong>Protein:</strong> <span id="gProt" class="num">0</span> g</div>
          <div class="badge"><strong>Fat:</strong> <span id="gFat" class="num">0</span> g</div>
        </div>
        <div id="safety" class="small" style="margin-top:8px"></div>
      </div>
      <div class="span-6" style="flex:1">
        <div class="title" style="margin-bottom:6px">Portion Guidance</div>
        <ul id="portionList"></ul>
      </div>
    </div>
    <div class="divider"></div>
    <div class="small">Notes: 1 lb ≈ 3500 kcal. Very aggressive goals can harm performance & recovery. Consider 0.5–2.0 lb/week and consult a clinician if unsure.</div>
  </section>
</main>

<script>
(function(){
  // ---------- DATA ----------
  const shares = { breakfast:.25, lunch:.30, dinner:.35, snack:.10 };

  // 10 options per meal, with per-serving nutrition (kcal, C/P/F grams) & a serving descriptor:
  const MENUS = {
    breakfast: [
      {name:"Oatmeal + berries",serv:"1 cup cooked + 1/2 cup berries",k:320,C:55,P:10,F:7, tips:"Add cinnamon; optional 1 tsp honey."},
      {name:"Greek yogurt parfait",serv:"1 cup yogurt + 1/4 cup granola",k:300,C:35,P:22,F:8,tips:"Add blueberries; choose low-sugar granola."},
      {name:"Egg white omelet",serv:"4 whites + veg + 1 slice toast",k:280,C:28,P:24,F:7,tips:"Olive oil spray; add spinach & mushrooms."},
      {name:"Protein shake",serv:"1 scoop + 1 banana + water",k:290,C:36,P:25,F:4,tips:"Add ice for volume; no added sugar."},
      {name:"Cottage cheese bowl",serv:"1 cup + pineapple",k:260,C:26,P:24,F:6,tips:"Great with chia seeds (1 tsp)."},
      {name:"Chia pudding",serv:"3 tbsp chia + milk alt",k:310,C:29,P:10,F:17,tips:"Prep overnight; add strawberries."},
      {name:"Avocado toast",serv:"1 slice whole grain + 1/2 avocado",k:310,C:28,P:7,F:18,tips:"Top with tomato & lemon."},
      {name:"Smoked salmon & rye",serv:"2 oz salmon + 1 slice rye",k:270,C:22,P:18,F:10,tips:"Add capers & dill."},
      {name:"Smoothie bowl",serv:"Fruit + spinach + protein",k:340,C:48,P:20,F:7,tips:"Keep toppings minimal."},
      {name:"Almond butter toast",serv:"1 slice + 1 tbsp AB",k:260,C:22,P:7,F:15,tips:"Pair with half banana."},
    ],
    lunch: [
      {name:"Grilled chicken + quinoa",serv:"4 oz + 3/4 cup",k:480,C:55,P:35,F:12,tips:"Add big salad."},
      {name:"Turkey wrap",serv:"Whole-grain wrap + veg",k:450,C:45,P:32,F:14,tips:"Light dressing."},
      {name:"Salmon + brown rice",serv:"4 oz + 3/4 cup",k:520,C:52,P:34,F:16,tips:"Steam broccoli."},
      {name:"Tofu stir-fry",serv:"5 oz tofu + veg + 1/2 cup rice",k:470,C:50,P:24,F:16,tips:"Use minimal oil."},
      {name:"Lean beef salad",serv:"4 oz + mixed greens",k:440,C:30,P:32,F:18,tips:"Vinaigrette on side."},
      {name:"Chicken burrito bowl",serv:"4 oz + beans + salsa",k:520,C:58,P:36,F:14,tips:"Skip sour cream."},
      {name:"Tuna sandwich",serv:"Whole grain + light mayo",k:430,C:40,P:30,F:14,tips:"Add tomato & cucumber."},
      {name:"Shrimp + couscous",serv:"4 oz + 3/4 cup",k:460,C:50,P:30,F:10,tips:"Lemon & herbs."},
      {name:"Lentil soup + side",serv:"2 cups + side salad",k:480,C:62,P:28,F:10,tips:"Watch bread portions."},
      {name:"Falafel wrap",serv:"Wrap + veg + tahini",k:500,C:55,P:18,F:18,tips:"Extra veggies, light sauce."},
    ],
    dinner: [
      {name:"Baked salmon + sweet potato",serv:"5 oz + medium potato",k:560,C:50,P:38,F:20,tips:"Roast asparagus."},
      {name:"Grilled chicken + broccoli",serv:"6 oz + 2 cups",k:500,C:28,P:46,F:18,tips:"Olive oil drizzle 1 tsp."},
      {name:"Lean steak + quinoa",serv:"5 oz + 3/4 cup",k:560,C:40,P:42,F:20,tips:"Add side salad."},
      {name:"Shrimp stir-fry",serv:"6 oz + veg + 1/2 cup rice",k:520,C:52,P:36,F:12,tips:"Low-sodium sauce."},
      {name:"Turkey meatballs + zoodles",serv:"5 oz + sauce",k:480,C:28,P:40,F:18,tips:"Parmesan 1 tbsp."},
      {name:"Tofu curry + brown rice",serv:"6 oz + 1/2 cup rice",k:540,C:60,P:26,F:18,tips:"Coconut milk light."},
      {name:"Baked cod + asparagus",serv:"6 oz + 2 cups",k:460,C:26,P:40,F:14,tips:"Lemon & capers."},
      {name:"Chicken fajitas",serv:"5 oz + 2 small tortillas",k:540,C:56,P:36,F:16,tips:"Guac 1 tbsp."},
      {name:"Lentil stew",serv:"2 cups",k:520,C:70,P:28,F:10,tips:"Add spinach."},
      {name:"Stuffed bell peppers",serv:"2 halves",k:500,C:54,P:30,F:14,tips:"Top with herbs."},
    ],
    snack: [
      {name:"Apple + PB",serv:"1 apple + 1 tbsp",k:220,C:32,P:4,F:9,tips:"Go natural PB."},
      {name:"Protein bar",serv:"1 bar",k:220,C:22,P:20,F:8,tips:"Choose low sugar."},
      {name:"Trail mix",serv:"1/4 cup",k:200,C:17,P:6,F:12,tips:"Weigh portions."},
      {name:"Hummus + carrots",serv:"1/4 cup + 1 cup carrots",k:180,C:22,P:5,F:7,tips:"Great fiber."},
      {name:"Cottage cheese",serv:"3/4 cup",k:150,C:8,P:18,F:4,tips:"Add pepper."},
      {name:"Rice cakes + AB",serv:"2 cakes + 1 tbsp",k:210,C:28,P:4,F:8,tips:"Drizzle honey 1 tsp."},
      {name:"Hard-boiled eggs",serv:"2 eggs",k:160,C:2,P:12,F:10,tips:"Dash salt."},
      {name:"Greek yogurt",serv:"3/4 cup",k:150,C:10,P:16,F:4,tips:"Add cinnamon."},
      {name:"Banana + walnuts",serv:"1 banana + 1 tbsp",k:230,C:32,P:4,F:10,tips:"Great pre-workout."},
      {name:"Celery + cream cheese",serv:"6 sticks + 1 tbsp",k:160,C:7,P:4,F:12,tips:"Crunchy low-carb."},
    ]
  };

  // Exercise energy model (kcal per min) using METs & weight
  // kcal/min ≈ MET * 3.5 * kg / 200
  const MET = { walk3_5:4.3, jog5:8.3, run6:9.8 };
  const WEIGHTS_BURN = { light:4, moderate:6, vigorous:8 }; // weights kcal/min rough

  // ---------- ELEMENTS ----------
  const weight = document.getElementById('weight');
  const lbsWeek = document.getElementById('lbsWeek');
  const maintenance = document.getElementById('maintenance');

  const deficit = document.getElementById('deficit');
  const deficitBadge = document.getElementById('deficitBadge');
  const dailyTarget = document.getElementById('dailyTarget');

  const mealType = document.getElementById('mealType');
  const mealCalBase = document.getElementById('mealCalBase');
  const mealShare = document.getElementById('mealShare');
  const menuChoice = document.getElementById('menuChoice');
  const randomize = document.getElementById('randomize');
  const menuMeta = document.getElementById('menuMeta');

  const willExercise = document.getElementById('willExercise');
  const exerciseBlock = document.getElementById('exerciseBlock');
  const cardioMin = document.getElementById('cardioMin');
  const cardioInt = document.getElementById('cardioInt');
  const weightsMin = document.getElementById('weightsMin');
  const weightsInt = document.getElementById('weightsInt');
  const exKcal = document.getElementById('exKcal');
  const dailyAdj = document.getElementById('dailyAdj');
  const mealCalAdj = document.getElementById('mealCalAdj');

  const mealTitle = document.getElementById('mealTitle');
  const chosenItem = document.getElementById('chosenItem');
  const mealCalFinal = document.getElementById('mealCalFinal');
  const gCarb = document.getElementById('gCarb');
  const gProt = document.getElementById('gProt');
  const gFat = document.getElementById('gFat');
  const portionList = document.getElementById('portionList');
  const safety = document.getElementById('safety');

  const cardioRec = document.getElementById('cardioRec');
  const weightsRec = document.getElementById('weightsRec');

  const genPlan = document.getElementById('genPlan');
  const resetBtn = document.getElementById('resetBtn');

  // ---------- HELPERS ----------
  const round = (n,p=0)=>{const f=Math.pow(10,p); return Math.round(n*f)/f;}
  const lbToKg = lb => lb*0.453592;
  const clamp = (n,a,b)=>Math.max(a,Math.min(b,n));

  function fillMenuOptions(){
    const list = MENUS[mealType.value];
    menuChoice.innerHTML = '';
    list.forEach((it, idx)=>{
      const opt = document.createElement('option');
      opt.value = idx;
      opt.textContent = `${it.name} — ${it.serv}`;
      menuChoice.appendChild(opt);
    });
    menuChoice.selectedIndex = 0;
    updateMenuMeta();
  }

  function updateMenuMeta(){
    const item = MENUS[mealType.value][menuChoice.selectedIndex];
    menuMeta.textContent = `Per serving ~ ${item.k} kcal | C ${item.C} g • P ${item.P} g • F ${item.F} g. Tips: ${item.tips}`;
  }

  function recompute(){
    const goal = Math.max(0, parseFloat(lbsWeek.value||0));
    const maint = Math.max(1000, parseFloat(maintenance.value||2000));
    const wt = Math.max(70, parseFloat(weight.value||160));

    // Deficit & dietary target
    const dailyDef = goal*3500/7;
    const dietTarget = maint - dailyDef;

    deficit.textContent = round(dailyDef);
    dailyTarget.textContent = round(dietTarget);

    // Badge
    let status=''; let cls='badge';
    if (dailyDef<=0){ status='No deficit'; }
    else if (dailyDef<=500){ status='Conservative'; cls+=' ok'; }
    else if (dailyDef<=1000){ status='Moderate'; }
    else { status='Aggressive'; cls+=' warn'; }
    deficitBadge.className = cls; deficitBadge.textContent = status;

    // Meal share & base meal cals
    const share = shares[mealType.value] || .25;
    mealShare.textContent = `${Math.round(share*100)}%`;
    const baseMeal = dietTarget * share;
    mealCalBase.textContent = round(baseMeal);

    // Exercise (optional actual)
    exerciseBlock.style.display = willExercise.checked ? 'block' : 'none';

    let ex = 0;
    if (willExercise.checked){
      const kg = lbToKg(wt);
      const met = cardioInt.value==='walk'?MET.walk3_5 : (cardioInt.value==='jog'?MET.jog5:MET.run6);
      const kcalPerMinCardio = met*3.5*kg/200;
      const kcalCardio = Math.max(0, (parseFloat(cardioMin.value)||0) * kcalPerMinCardio);
      const kcalWeights = (parseFloat(weightsMin.value)||0) * WEIGHTS_BURN[weightsInt.value];
      ex = kcalCardio + kcalWeights;
    }
    exKcal.textContent = round(ex);
    const dailyAdjusted = dietTarget + ex;
    dailyAdj.textContent = round(dailyAdjusted);
    const mealAdjusted = dailyAdjusted * share;
    mealCalAdj.textContent = round(mealAdjusted);

    // Choose item
    const item = MENUS[mealType.value][menuChoice.selectedIndex];
    mealTitle.textContent = mealType.value.charAt(0).toUpperCase()+mealType.value.slice(1);
    chosenItem.textContent = item.name;

    // Final target for meal
    const finalCals = willExercise.checked ? mealAdjusted : baseMeal;
    mealCalFinal.textContent = round(finalCals);

    // Scale serving to meet target
    const factor = clamp(finalCals / item.k, 0.4, 2.5); // between 0.4x and 2.5x of listed serving
    const Cg = item.C*factor, Pg = item.P*factor, Fg = item.F*factor;
    gCarb.textContent = round(Cg);
    gProt.textContent = round(Pg);
    gFat.textContent  = round(Fg);

    // Portion guidance
    portionList.innerHTML = `
      <li><strong>Base serving:</strong> ${item.serv}</li>
      <li><strong>Suggested portion factor:</strong> × <span class="num">${round(factor,2)}</span> (to hit ~${round(finalCals)} kcal)</li>
      <li><strong>Tip:</strong> ${item.tips}</li>
    `;

    // Safety hints
    const notes=[];
    if (dietTarget < 1200) notes.push(`<span class="danger">Warning:</span> dietary target under 1200 kcal/day is very low for most adults.`);
    if (goal > 2) notes.push(`<span class="warn">Aggressive goal:</span> ${round(goal,1)} lb/week is hard to sustain; consider ≤2 lb/week.`);
    safety.innerHTML = notes.join(' ') || '';

    // Build recommendations (cardio/weights) to safely meet the goal
    buildRecommendations(wt, maint, dailyDef, dietTarget);
  }

  function buildRecommendations(wt, maint, dailyDef, dietTarget){
    const kg = lbToKg(wt);

    // Keep diet deficit reasonable (cap at 750 kcal/day & never below 1200 kcal intake).
    const maxDietDef = Math.min(750, Math.max(0, maint-1200));
    const dietDeficitUsed = Math.min(dailyDef, maxDietDef);
    const exerciseNeeded = Math.max(0, dailyDef - dietDeficitUsed);

    // Choose modality based on size of remaining deficit
    // Map remaining kcal -> time & speed tier
    let tier, mph, met;
    if (exerciseNeeded <= 200){ tier = 'Light walk'; mph = 3.0; met = 3.3; }
    else if (exerciseNeeded <= 400){ tier = 'Brisk walk'; mph = 3.5; met = MET.walk3_5; }
    else if (exerciseNeeded <= 650){ tier = 'Jog'; mph = 5.0; met = MET.jog5; }
    else { tier = 'Run'; mph = 6.0; met = MET.run6; }

    const kcalPerMin = met*3.5*kg/200;
    const minutesNeeded = kcalPerMin>0 ? Math.ceil(exerciseNeeded / kcalPerMin) : 0;

    // Build cardio text
    const cardioText = (dailyDef<=0)
      ? "No cardio required for weight loss today based on your inputs. Light activity (20–30 min walk) is still beneficial."
      : (exerciseNeeded===0
          ? `Diet alone can meet today's target. Optional: ${tier} ${tier.includes('walk')?'20–30':'20–25'} min for health & recovery.`
          : `${tier}: about <b>${minutesNeeded} min</b> at ~<b>${mph} mph</b> to cover ~<b>${Math.round(exerciseNeeded)} kcal</b> of today's goal.`);

    cardioRec.innerHTML = `
      <div class="key" style="grid-template-columns:1fr">
        <div>${cardioText}</div>
        <div class="small">We split the deficit safely: diet up to ~${maxDietDef} kcal/day, remainder via activity.</div>
      </div>`;

    // Weight training recommendation (goal-aware)
    let level, sets, reps, rest, moves;
    if (dailyDef <= 400){ level='Moderate'; sets='3'; reps='8–12'; rest='60–90s';
      moves=['Goblet squats','Push-ups / incline','Bent-over rows','Hip hinge (RDL)','Plank 45–60s']; }
    else if (dailyDef <= 800){ level='Conservative Hypertrophy'; sets='2–3'; reps='8–10'; rest='60s';
      moves=['Squats or leg press','DB bench press','Lat pulldown / rows','Split squats','Side plank 30–45s']; }
    else { level='Recovery-first'; sets='2'; reps='10–12'; rest='60s';
      moves=['Bodyweight squats','Incline push-ups','Band rows','Glute bridges','Dead bug 6–8/side']; }

    // Adjust volume slightly by body weight
    const volAdj = wt>220 ? '+1 set lower body' : (wt<130 ? 'keep loads light' : 'standard loads');
    weightsRec.innerHTML = `
      <div class="key" style="grid-template-columns:1fr">
        <div><b>${level} full-body</b> ${sets} sets × ${reps} reps • Rest ${rest}</div>
        <ul style="margin:6px 0 0 18px">
          ${moves.map(m=>`<li>${m}</li>`).join('')}
        </ul>
        <div class="small">Volume note: ${volAdj}. Prioritize technique; stop 1–2 reps before failure.</div>
      </div>`;
  }

  // ---------- EVENTS ----------
  mealType.addEventListener('change', ()=>{ fillMenuOptions(); recompute(); });
  menuChoice.addEventListener('change', ()=>{ updateMenuMeta(); recompute(); });
  randomize.addEventListener('click', ()=>{ 
    const n = MENUS[mealType.value].length;
    menuChoice.selectedIndex = Math.floor(Math.random()*n); 
    updateMenuMeta(); recompute();
  });

  willExercise.addEventListener('input', ()=>{ exerciseBlock.style.display = willExercise.checked?'block':'none'; recompute(); });
  [cardioMin, cardioInt, weightsMin, weightsInt].forEach(el=> el.addEventListener('input', recompute));

  [weight, lbsWeek, maintenance].forEach(el=> el.addEventListener('input', recompute));

  document.getElementById('genPlan').addEventListener('click', recompute);

  document.getElementById('resetBtn').addEventListener('click', ()=>{
    weight.value = 160; lbsWeek.value = 1.0; maintenance.value = 2000;
    mealType.value = 'breakfast'; willExercise.checked = false;
    cardioMin.value = 30; cardioInt.value = 'jog'; weightsMin.value = 20; weightsInt.value='moderate';
    exerciseBlock.style.display='none';
    fillMenuOptions();
    recompute();
  });

  // ---------- INIT ----------
  fillMenuOptions();
  recompute();
})();
</script>
</body>
</html>
